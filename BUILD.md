# راهنمای ساخت udp2raw برای ویندوز و لینوکس

این راهنما به شما کمک می‌کند تا پروژه udp2raw را به راحتی در سیستم‌های عامل ویندوز و لینوکس کامپایل کنید.

## پیش‌نیازها

### لینوکس
- کامپایلر C++ (g++ یا clang++)
- CMake (نسخه 3.7 یا بالاتر)
- make
- کتابخانه‌های توسعه pthread و rt

### ویندوز
- MinGW-w64 با پشتیبانی از posix threads
- CMake (نسخه 3.7 یا بالاتر)
- (اختیاری) Visual Studio با پشتیبانی از CMake

## روش‌های ساخت

### استفاده از اسکریپت ساخت خودکار

ساده‌ترین روش استفاده از اسکریپت `build.sh` است که به صورت خودکار پروژه را برای سیستم عامل شما کامپایل می‌کند:

```bash
# در لینوکس
chmod +x build.sh
./build.sh

# برای ساخت نسخه استاتیک
./build.sh --static

# برای ساخت نسخه دیباگ
./build.sh --debug

# برای ساخت نسخه ویندوز (کراس-کامپایل در لینوکس)
./build.sh --windows
```

### استفاده مستقیم از CMake

#### لینوکس

```bash
# ایجاد دایرکتوری ساخت
mkdir -p build && cd build

# پیکربندی پروژه
cmake ..

# کامپایل
make -j$(nproc)

# نصب (اختیاری)
sudo make install
```

#### ویندوز با MinGW

```bash
# ایجاد دایرکتوری ساخت
mkdir build
cd build

# پیکربندی پروژه
cmake -G "MinGW Makefiles" ..

# کامپایل
mingw32-make
```

#### ویندوز با Visual Studio

1. پروژه را در Visual Studio باز کنید
2. فولدر پروژه را به عنوان یک پروژه CMake باز کنید
3. از منوی Build گزینه Build All را انتخاب کنید

### استفاده از makefile اصلی

همچنان می‌توانید از makefile اصلی پروژه نیز استفاده کنید:

```bash
# در لینوکس
make

# در ویندوز با MinGW
make mingw
```

## گزینه‌های پیکربندی CMake

- `STATIC_LINK`: فعال‌سازی لینک استاتیک (پیش‌فرض: OFF)
- `ENABLE_SANITIZERS`: فعال‌سازی sanitizer های آدرس و رفتار نامشخص (پیش‌فرض: OFF)
- `ENABLE_MP`: فعال‌سازی پشتیبانی چند پلتفرمی (پیش‌فرض در ویندوز: ON)
- `USE_WEPOLL`: استفاده از wepoll به جای libev داخلی (فقط ویندوز، پیش‌فرض: OFF)

مثال:
```bash
cmake -DSTATIC_LINK=ON -DENABLE_SANITIZERS=OFF ..
```

## عیب‌یابی مشکلات رایج

### مشکل در لینک کتابخانه‌ها در لینوکس
اگر با خطای کتابخانه‌های گمشده مواجه شدید، بسته‌های توسعه مورد نیاز را نصب کنید:
```bash
sudo apt-get install libpthread-dev
```

### مشکل در کامپایل در ویندوز
اطمینان حاصل کنید که از نسخه MinGW با پشتیبانی از posix threads استفاده می‌کنید:
```bash
i686-w64-mingw32-g++-posix --version
```

### مشکل در اجرای فایل اجرایی در ویندوز
اگر با خطای DLL های گمشده مواجه شدید، از گزینه لینک استاتیک استفاده کنید:
```bash
cmake -DSTATIC_LINK=ON ..
```

یا با استفاده از اسکریپت ساخت:
```bash
./build.sh --windows --static
```